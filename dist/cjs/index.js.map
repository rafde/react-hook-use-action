{"mappings":";;;;;;;;;;;AGUO,MAAM;IAKZ,YAAa,KAAwC,CAAI;QACxD,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;QACtB,IAAI,CAAC,SAAS,GAAG,MAAM,SAAS;QAChC,IAAI,CAAC,OAAO,GAAG;YACd,WAAW;YACX,GAAG,OAAO,OAAO;QAClB;IACD;AACD;AAEO,MAAM,kDAAuD;IAEnE,OAAO,OAAqC,SAAkB,EAAE,OAAsD,EAAI;QACzH,OAAO,IAAI,0CAAmB;uBAC7B;qBACA;QACD;IACD;IAEA,YAAa,KAAkF,CAAI;QAClG,KAAK,CAAE;YACN,GAAG,KAAK;YACR,MAAM;QACP;aAZQ,OAAO;IAahB;AACD;AAEO,MAAM,kDAA8D;IAE1E,OAAO,OAAqC,SAAkB,EAAE,OAAsD,EAAI;QACzH,OAAO,IAAI,0CAA0B;uBACpC;qBACA;QACD;IACD;IAEA,YAAa,KAAkF,CAAI;QAClG,KAAK,CAAE;YACN,GAAG,KAAK;YACR,MAAM;QACP;aAZQ,OAAO;IAahB;AACD;AAEO,MAAM,kDAAqD;IAEjE,OAAO,OAAqC,SAAkB,EAAE,OAAsD,EAAI;QACzH,OAAO,IAAI,0CAAiB;uBAC3B;qBACA;QACD;IACD;IAEA,YAAa,KAAkF,CAAI;QAClG,KAAK,CAAE;YACN,GAAG,KAAK;YACR,MAAM;QACP;aAZQ,OAAO;IAahB;AACD;AAEO,MAAM,kDAAsD;IAElE,OAAO,OAAqC,SAAkB,EAAE,OAAsD,EAAI;QACzH,OAAO,IAAI,0CAAkB;uBAC5B;qBACA;QACD;IACD;IAEA,YAAa,KAA2F,CAAI;QAC3G,KAAK,CAAE;YACN,GAAG,KAAK;YACR,MAAM;QACP;aAZQ,OAAO;IAahB;AACD;;;AD5EA,SAAS,8CACR,KAAc,EACd,OAA4C,EAC5C,UAAkD;IAElD,MAAM,cAAuC,CAAC;IAC9C,WAAW,KAAK;IAEhB,IAAM,MAAM,OAAO,MAAQ;QAC1B,MAAM,QAAQ,KAAK,CAAE,IAAK;QAC1B,WAAW,CAAE,IAAK,GAAG;QAErB,IAAK,CAAA,GAAA,iCAAc,EAAG,OAAO,CAAE,IAAK,EAAE,QAAW;YAChD,WAAW,MAAM,CAAE;YACnB;QACD;QACA,WAAW,GAAG,CAAE,KAAK;IACtB;IAEA,IAAM,MAAM,OAAO,QAAU;QAC5B,IAAK,WAAW,CAAE,IAAK,EACtB;QAED,MAAM,QAAQ,OAAO,CAAE,IAAK;QAC5B,WAAW,GAAG,CAAE,KAAK;IACtB;AACD;AAEA,SAAS,+BACR,eAAyC,EACzC,OAAgB;IAEhB,MAAM,cACL,UAAU,EACV,GAAG;IACJ,8CAAyB,SAAS,gBAAgB,OAAO,EAAE;IAE3D,OAAO;QACN,GAAG,eAAe;QAClB,SAAS,WAAW,IAAI,GAAG,OAAO,WAAW,CAAE,cAA8C;QAC7F,SAAS;QACT,UAAU,gBAAgB,OAAO;IAClC;AACD;AAEA,SAAS,sCACR,eAAyC,EACzC,OAAgB;IAEhB,MAAM,cACL,UAAU,EACV,GAAG;IACJ,8CAAyB,gBAAgB,OAAO,EAAE,SAAS,gBAAgB,UAAU;IAErF,OAAO;QACN,GAAG,eAAe;QAClB,SAAS,WAAW,IAAI,GAAG,OAAO,WAAW,CAAE,cAA8C;iBAC7F;IACD;AACD;AAEA,SAAS,8BACR,eAAyC,EACzC,OAAyB;IAEzB,MAAM,UAAmC,CAAC;IAC1C,IAAI,aAAa;IACjB,MAAM,EACL,SAAS,QAAQ,EACjB,GAAG,MACH,GAAG;IACJ,MAAM,WACL,OAAO,cACP,UAAU,EACV,GAAG;IAEJ,IAAM,MAAM,OAAO,QAAU;QAC5B,MAAM,QAAQ,OAAO,CAAE,IAAK;QAC5B,IAAK,CAAA,GAAA,iCAAc,EAAG,QAAQ,CAAE,IAAsB,EAAE,QACvD;QAGD,OAAO,CAAE,IAAK,GAAG;QACjB,aAAa;QAEb,IAAK,CAAA,GAAA,iCAAc,EAAG,OAAO,CAAE,IAAsB,EAAE,QACtD,WAAW,MAAM,CAAE;aAGnB,WAAW,GAAG,CAAE,KAAK;IAEvB;IAEA,IAAK,CAAC,YACL,OAAO;IAGR,OAAO;QACN,GAAG,IAAI;QACP,SAAS,WAAW,IAAI,GAAG,OAAO,WAAW,CAAE,cAA8C;QAC7F,SAAS;YACR,GAAG,QAAQ;YACX,GAAG,OAAO;QACX;kBACA;IACD;AACD;AAEA,MAAM,+CAAyB;IAC9B,SAAS;IACT,gBAAgB;IAChB,OAAO;IACP,QAAQ;AACT;AAIA,SAAS,iCAKR,KAIC;IAED,MAAM,QACL,IAAI,mBACJ,eAAe,EACf,GAAG;IAEJ,IAAK,CAAC,QAAQ,OAAO,SAAS,YAAY,MAAM,OAAO,CAAE,SAAW,gBAAgB,CAAA,GAAA,yCAAS,GAC5F,OAAO;IAGR,MAAM,QACL,IAAI,EACJ,GAAG;IACJ,MAAM,cACL,UAAU,WACV,OAAO,WACP,OAAO,EACP,GAAG;IAEJ,IAAK,SAAS,SAAU;QACvB,IAAK,CAAA,GAAA,iCAAc,EAAG,SAAS,SAAW,CAAA,GAAA,iCAAc,EAAG,SAAS,OACnE,OAAO;QAGR,WAAW,KAAK;QAChB,OAAO;wBACN;YACA,SAAS;YACT,SAAS;YACT,SAAS;YACT,UAAU;QACX;IACD;IAEA,IAAK,SAAS,WACb,OAAO,+BACN,iBACA;IAIF,IAAK,SAAS,kBACb,OAAO,sCACN,iBACA;IAIF,OAAO,8BACN,iBACA;AAEF;AAEA,SAAS,oCAGN,aAA4D;IAC9D,IAAK,yBAAyB,CAAA,GAAA,yCAAS,GAAI;QAC1C,MAAM,QACL,IAAI,aACJ,SAAS,WACT,OAAO,EACP,GAAG;QAEJ,IAAK,CAAC,aAAa,OAAO,cAAc,YAAY,MAAM,OAAO,CAAE,YAClE;QAGD,OAAO;YACN,MAAM;kBACN;YACA,WAAW,QAAS,SAAS;QAC9B;IASD;IAEA,IAAK,iBAAiB,OAAO,kBAAkB,UAC9C,OAAO;QACN,MAAM;QACN,MAAM;QACN,WAAW;IACZ;AAEF;AAMe,kDAGZ,MAIF;IACA,MAAM,EACL,MAAM,OAAO,EACb,SAAS,mBAAmB,EAC5B,GAAG,OAAO,YAAY;IACvB,MAAM,mBACL,eAAe,WACf,OAAO,EACP,GAAG;IACJ,MAAM,cACL,UAAU,WACV,OAAO,WACP,OAAO,EACP,GAAG;IACJ,MAAM,WAAmD;QACxD,SAAS,gBAAgB,OAAO;iBAChC;iBACA;QACA,UAAU,gBAAgB,QAAQ;IACnC;IAEA,MAAM,kBAAkB,WAAW,OAAO,WAAW,YAAY,CAAC,MAAM,OAAO,CAAE;IACjF,IAAK,WAAW,gDAA0B,CAAC,iBAAkB;QAC5D,IAAK,YAAY,WAAW,CAAC,qBAAsB;YAClD,WAAW,KAAK;YAChB,OAAO;gBACN,GAAG,eAAe;gBAClB,SAAS;gBACT,SAAS;gBACT,UAAU;YACX;QACD;QAEA,MAAM,sBAAsB,+BAA+B,WAAW,oBAAqB,YAAc;QAEzG,OAAO,iCAAY;6BAClB;YACA,MAAM;YACN,MAAM;QACP;IACD;IAEA,MAAM,MAAM,mBAAmB,SAAS,CAAE,QAAiC;IAE3E,IAAK,OAAO,QAAQ,YACnB,OAAO;IAGR,IAAK,YAAY,WAAW,CAAC,qBAAsB;QAClD,MAAM,iBAAiB,IACtB;QAGD,IAAK,CAAC,gBACL,OAAO;QAGR,WAAW,KAAK;QAChB,OAAO;YACN,GAAG,eAAe;YAClB,SAAS;YACT,SAAS;YACT,UAAU;QACX;IACD;IAEA,IAAI,cAAc;IAClB,IAAK,+BAA+B,UAAW;QAC9C,cAAc,oBACb;QAGD,IAAK,CAAC,aACL,OAAO;IAET;IAEA,IAAK,WAAW,8CACf,OAAO,iCAAY;yBAClB;QACA,MAAM,IACL,UACA;QAED,MAAM;IACP;IAGD,MAAM,YAAY,IACjB;QACC,GAAG,QAAQ;QACX,eAAe,CAAA,GAAA,yCAAgB,EAAE,MAAM;QACvC,sBAAsB,CAAA,GAAA,yCAAuB,EAAE,MAAM;QACrD,aAAa,CAAA,GAAA,yCAAc,EAAE,MAAM;QACnC,cAAc,CAAA,GAAA,yCAAe,EAAE,MAAM;IACtC,GACA;IAGD,IAAK,CAAC,WACL,OAAO;IAGR,MAAM,aAAa,oCAAe;IAElC,IAAK,CAAC,YACL,OAAO;IAGR,MAAM,QACL,IAAI,aACJ,SAAS,EACT,GAAG;IAEJ,IAAI,QACH,IAAI,EACJ,GAAG;IAEJ,MAAM,sBAAsB,mBAAmB,SAAS,CAAE,KAA8B;IAExF,IAAK,OAAO,wBAAwB,cAAc,WACjD,OAAO,oBAAqB,UAAU;IAGvC,OAAO,iCAAY;yBAClB;cACA;cACA;IACD;AACD;;;AD/WA,SAAS,4BAIR,eAAyC,EACzC,IAAkD;IAElD,MAAM,aAAa,IAAI;IACvB,IAAK,OAAO,SAAS,YACpB,OAAO;QACN,GAAG,eAAe;oBAClB;IACD;IAGD,MAAM,UAAU,KAAM,gBAAgB,OAAO;IAC7C,OAAO;QACN,GAAG,eAAe;oBAClB;QACA,SAAS;iBACT;IACD;AACD;AAEe,kDAId,MAAyC;IAEzC,OAAO,CAAA,GAAA,uBAAS,EACf,SAAS,gBAAiB,eAAyC,EAAE,YAAgF;QACpJ,OAAO,CAAA,GAAA,wCAAS,EAAG;6BAClB;YACA,SAAS,OAAO,OAAO;0BACvB;QACD;IACD,GACA;QACC,SAAS;QACT,sFAAsF;QACtF,YAAY;QACZ,SAAS,OAAO,OAAO;QACvB,SAAS,OAAO,OAAO;QACvB,UAAU,OAAO,OAAO;IACzB,GACA,SAAS,QAAS,eAAyC;QAC1D,OAAO,4BAAyB,iBAAiB,OAAO,MAAM;IAC/D;AAEF;;;;AGlDA,SAAS,mDAIR,QAAuC,EACvC,gBAAmD,EACnD,SAAmB;IAInB,IAAI,kBAAkB;IACtB,MAAM,gBAAgB,CAAC;IAIvB,IAAM,MAAM,QAAQ,UAAY;QAC/B,IAAK,QAAQ,oBAAoB,OAAO,SAAS,CAAE,KAAM,KAAK,YAC7D;QAGD,aAAa,CAAE,KAA+C,GAAG,CAAE;YAClE,SAAU;sBACT;yBACA;YACD;QACD;QAEA,kBAAkB;IACnB;IAEA,IAAK,CAAC,iBACL,OAAO;IAGR,OAAO,OAAO,MAAM,CACnB,kBACA;AAEF;AAEA,SAAS,4CAIR,UAAqD,EACrD,OAAiB;IAEjB,MAAM,mBAAkD,CAAE;QACzD,WAAY;IACb;IAEA,MAAM,MAAyC;QAC9C,SAAS,OAAO;YACf,iBAAkB;gBACjB,MAAM;yBACN;YACD;QACD;QACA,gBAAgB,OAAO;YACtB,iBAAkB;gBACjB,MAAM;yBACN;YACD;QACD;QACA,OAAO,OAAO;YACb,iBAAkB;gBACjB,MAAM;yBACN;YACD;QACD;QACA,QAAQ,OAAO,EAAE,KAAK;YACrB,OAAS,OAAO;gBACf,KAAK;gBACL,KAAK;oBACJ,iBAAkB;wBACjB,MAAM;wBACN,SAAS;4BACR,CAAE,QAAS,EAAE;wBACd;oBACD;oBACA;gBACD;oBACC,iBAAkB;wBACjB,MAAM;iCACN;oBACD;oBACA;YACF;QACD;IACD;IAEA,IAAK,WAAW,QAAQ,OAAO,YAAY,UAC1C,OAAO,OAAO,MAAM,CACnB,kBACA;aACC;IACD;IAIF,OAAO,OAAO,MAAM,CACnB,kBACA;QACC,KAAK,mDAA8B,kBAAkB,KAAK;IAC3D;AAEF;AAEe,kDAGZ,MAGF;IACA,MAAM,WACL,OAAO,EACP,GAAG;IACJ,MAAM,CACL,UACA,YACA,GAAG,OAAO,eAAe;IAE1B,MAAM,sBAAsB,CAAA,GAAA,oBAAM,EACjC,IAAM,4CAAyC,aAAa,UAC5D;QACC;QACA;KACA;IAGF,OAAO,CAAA,GAAA,oBAAM,EACZ;QACC,MAAM,QAAwD;YAC7D,SAAS,SAAS,OAAO;YACzB,SAAS,SAAS,OAAO;YACzB,SAAS,SAAS,OAAO;YACzB,UAAU,SAAS,QAAQ;QAC5B;QACA,MAAM,WAAW,OAAO,MAAM,CAC7B,qBACA;mBACC;QACD;QAED,OAAO;YACN,SAAS,OAAO;YAChB;SACA;IACF,GACA;QACC;QACA;KACA;AAEH;;;AJ3JO,SAAS,0CAIf,eAAkD;IAElD,MAAM,kBAAkB,CAAA,GAAA,wCAAY,EAAG;IACvC,OAAO,CAAA,GAAA,wCAAW,EAAG;QACpB,SAAS,gBAAgB,OAAO;yBAChC;IACD;AACD","sources":["src/index.ts","src/internal/usePrivateCTA.ts","src/internal/ctaReducer.ts","src/internal/ActionTypes.ts","src/internal/usePublicCTA.ts"],"sourcesContent":["import usePrivateCTA from './internal/usePrivateCTA';\nimport usePublicCTA from './internal/usePublicCTA';\n\nimport type { CTAInitial, } from './types/CTAInitial';\nimport type { UseCTAParameterActionsRecordProp, } from './types/UseCTAParameterActionsRecordProp';\nimport type { UseCTAParameter, } from './types/UseCTAParameter';\nimport type { UseCTAReturnType, } from './types/UseCTAReturnType';\n\nexport function useCTA<\n\tInitial extends CTAInitial,\n\tActions extends UseCTAParameterActionsRecordProp<Initial> | undefined,\n>(\n\tuseCTAParameter: UseCTAParameter<Initial, Actions>,\n): UseCTAReturnType<Initial, Actions> {\n\tconst stateDispatcher = usePrivateCTA( useCTAParameter, );\n\treturn usePublicCTA( {\n\t\tactions: useCTAParameter.actions,\n\t\tstateDispatcher,\n\t}, );\n}\n\nexport type { CTAInitial, } from './types/CTAInitial';\n\nexport type { CustomCTAParam, } from './types/CustomCTAParam';\n\nexport type { CustomCTAReturnType, } from './types/CustomCTAReturnType';\n\nexport type { UseCTAParameter, } from './types/UseCTAParameter';\n\nexport type { UseCTAReturnTypeDispatch, UseCTAReturnTypeDispatchState, } from './types/UseCTAReturnTypeDispatch';\n\nexport type { UseCTAReturnType, } from './types/UseCTAReturnType';\n","import { useReducer, } from 'react';\nimport { UseCTAParameterActionsRecordProp, } from '../types/UseCTAParameterActionsRecordProp';\n\nimport ctaReducer, { CTAReducerState, } from './ctaReducer';\n\nimport type { CTAInitial, } from '../types/CTAInitial';\nimport type { UseCTAParameter, } from '../types/UseCTAParameter';\n\nfunction _init<\n\tInitial extends CTAInitial,\n\tActions extends UseCTAParameterActionsRecordProp<Initial> | undefined,\n>(\n\tprivateCTAState: CTAReducerState<Initial>,\n\tinit?: UseCTAParameter<Initial, Actions>['onInit'],\n): CTAReducerState<Initial> {\n\tconst changesMap = new Map() as CTAReducerState<Initial>['changesMap'];\n\tif ( typeof init !== 'function' ) {\n\t\treturn {\n\t\t\t...privateCTAState,\n\t\t\tchangesMap,\n\t\t};\n\t}\n\n\tconst initial = init( privateCTAState.current, );\n\treturn {\n\t\t...privateCTAState,\n\t\tchangesMap,\n\t\tcurrent: initial,\n\t\tinitial,\n\t};\n}\n\nexport default function usePrivateCTA<\n\tInitial extends CTAInitial,\n\tActions extends UseCTAParameterActionsRecordProp<Initial> | undefined,\n>(\n\tparams: UseCTAParameter<Initial, Actions>,\n) {\n\treturn useReducer(\n\t\tfunction reducerCallback( ctaReducerState: CTAReducerState<Initial>, nextCTAProps: Parameters<typeof ctaReducer<Initial, Actions>>[0]['nextCTAProps'], ) {\n\t\t\treturn ctaReducer( {\n\t\t\t\tctaReducerState,\n\t\t\t\tactions: params.actions,\n\t\t\t\tnextCTAProps,\n\t\t\t}, );\n\t\t},\n\t\t{\n\t\t\tchanges: null,\n\t\t\t// Set changesMap in init to avoid re-instantiating a new Map everytime this is called\n\t\t\tchangesMap: undefined as unknown as CTAReducerState<Initial>['changesMap'],\n\t\t\tcurrent: params.initial,\n\t\t\tinitial: params.initial,\n\t\t\tprevious: params.initial,\n\t\t},\n\t\tfunction _onInit( privateCTAState: CTAReducerState<Initial>, ) {\n\t\t\treturn _init<Initial, Actions>( privateCTAState, params.onInit, );\n\t\t},\n\t);\n}\n\nexport type UsePrivateCTAReturnType<\n\tInitial extends CTAInitial,\n\tActions extends UseCTAParameterActionsRecordProp<Initial> | undefined,\n> = ReturnType<typeof usePrivateCTA<Initial, Actions>>;\n\nexport type UsePrivateCTADispatcher<\n\tInitial extends CTAInitial,\n\tActions extends UseCTAParameterActionsRecordProp<Initial> | undefined,\n> = UsePrivateCTAReturnType<Initial, Actions>[1];\n","import { strictDeepEqual, } from 'fast-equals';\n\nimport type { CTAInitial, } from '../types/CTAInitial';\nimport {\n\tUseCTAParameterActionsCustomRecord,\n} from '../types/UseCTAParameterActionsRecordProp';\nimport type { DispatchCTA, UseCTAReturnTypeDispatchState, } from '../types/UseCTAReturnTypeDispatch';\nimport {\n\tActionType,\n\tReplaceActionType,\n\tReplaceInitialActionType,\n\tResetActionType,\n\tUpdateActionType,\n} from './ActionTypes';\n\nfunction _resetCurrentChangesMap<Initial extends CTAInitial,>(\n\tstate: Initial,\n\tinitial: CTAReducerState<Initial>['initial'],\n\tchangesMap: CTAReducerState<Initial>['changesMap'],\n) {\n\tconst checkedKeys: Record<string, boolean> = {};\n\tchangesMap.clear();\n\n\tfor ( const key in state ) {\n\t\tconst value = state[ key ];\n\t\tcheckedKeys[ key ] = true;\n\n\t\tif ( strictDeepEqual( initial[ key ], value, ) ) {\n\t\t\tchangesMap.delete( key, );\n\t\t\tcontinue;\n\t\t}\n\t\tchangesMap.set( key, value, );\n\t}\n\n\tfor ( const key in initial ) {\n\t\tif ( checkedKeys[ key ] ) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst value = initial[ key ];\n\t\tchangesMap.set( key, value, );\n\t}\n}\n\nfunction _replace<Initial extends CTAInitial,>(\n\tctaReducerState: CTAReducerState<Initial>,\n\tpayload: Initial,\n): CTAReducerState<Initial> {\n\tconst {\n\t\tchangesMap,\n\t} = ctaReducerState;\n\t_resetCurrentChangesMap( payload, ctaReducerState.initial, changesMap, );\n\n\treturn {\n\t\t...ctaReducerState,\n\t\tchanges: changesMap.size ? Object.fromEntries( changesMap, ) as Readonly<Partial<Initial>> : null,\n\t\tcurrent: payload,\n\t\tprevious: ctaReducerState.current,\n\t};\n}\n\nfunction _replaceInitial<Initial extends CTAInitial,>(\n\tctaReducerState: CTAReducerState<Initial>,\n\tinitial: Initial,\n): CTAReducerState<Initial> {\n\tconst {\n\t\tchangesMap,\n\t} = ctaReducerState;\n\t_resetCurrentChangesMap( ctaReducerState.current, initial, ctaReducerState.changesMap, );\n\n\treturn {\n\t\t...ctaReducerState,\n\t\tchanges: changesMap.size ? Object.fromEntries( changesMap, ) as Readonly<Partial<Initial>> : null,\n\t\tinitial,\n\t};\n}\n\nfunction _update<Initial extends CTAInitial,>(\n\tctaReducerState: CTAReducerState<Initial>,\n\tpayload: Partial<Initial>,\n): CTAReducerState<Initial> {\n\tconst current: Record<string, unknown> = {};\n\tlet hasUpdates = false;\n\tconst {\n\t\tcurrent: previous,\n\t\t...rest\n\t} = ctaReducerState;\n\tconst {\n\t\tinitial,\n\t\tchangesMap,\n\t} = ctaReducerState;\n\n\tfor ( const key in payload ) {\n\t\tconst value = payload[ key ];\n\t\tif ( strictDeepEqual( previous[ key as keyof Initial ], value, ) ) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tcurrent[ key ] = value;\n\t\thasUpdates = true;\n\n\t\tif ( strictDeepEqual( initial[ key as keyof Initial ], value, ) ) {\n\t\t\tchangesMap.delete( key, );\n\t\t}\n\t\telse {\n\t\t\tchangesMap.set( key, value, );\n\t\t}\n\t}\n\n\tif ( !hasUpdates ) {\n\t\treturn ctaReducerState;\n\t}\n\n\treturn {\n\t\t...rest,\n\t\tchanges: changesMap.size ? Object.fromEntries( changesMap, ) as Readonly<Partial<Initial>> : null,\n\t\tcurrent: {\n\t\t\t...previous,\n\t\t\t...payload,\n\t\t},\n\t\tprevious,\n\t};\n}\n\nconst predefinedActionsConst = {\n\treplace: 'replace',\n\treplaceInitial: 'replaceInitial',\n\treset: 'reset',\n\tupdate: 'update',\n} as const;\n\ntype PredefinedActions = keyof typeof predefinedActionsConst;\n\nfunction typeResult<\n\tInitial extends CTAInitial,\n\tType extends PredefinedActions,\n\tNext = Type extends 'update' ? Partial<Initial> : Initial,\n>(\n\tparam: {\n\t\tctaReducerState: CTAReducerState<Initial>\n\t\ttype: Type\n\t\tnext: Next\n\t},\n) {\n\tconst {\n\t\tnext,\n\t\tctaReducerState,\n\t} = param;\n\n\tif ( !next || typeof next !== 'object' || Array.isArray( next, ) || next instanceof ActionType ) {\n\t\treturn ctaReducerState;\n\t}\n\n\tconst {\n\t\ttype,\n\t} = param;\n\tconst {\n\t\tchangesMap,\n\t\tcurrent,\n\t\tinitial,\n\t} = ctaReducerState;\n\n\tif ( type === 'reset' ) {\n\t\tif ( strictDeepEqual( initial, next, ) || strictDeepEqual( current, next, ) ) {\n\t\t\treturn ctaReducerState;\n\t\t}\n\n\t\tchangesMap.clear();\n\t\treturn {\n\t\t\tchangesMap,\n\t\t\tchanges: null,\n\t\t\tinitial: next as Initial,\n\t\t\tcurrent: next as Initial,\n\t\t\tprevious: current,\n\t\t};\n\t}\n\n\tif ( type === 'replace' ) {\n\t\treturn _replace(\n\t\t\tctaReducerState,\n\t\t\tnext as Initial,\n\t\t);\n\t}\n\n\tif ( type === 'replaceInitial' ) {\n\t\treturn _replaceInitial(\n\t\t\tctaReducerState,\n\t\t\tnext as Initial,\n\t\t);\n\t}\n\n\treturn _update(\n\t\tctaReducerState,\n\t\tnext,\n\t);\n}\n\nfunction getActionType<\n\tInitial extends CTAInitial,\n\tCTAReturnType extends UseCTAParameterActionsCustomRecord<Initial>[string | number],\n>( ctaReturnType: Exclude<ReturnType<CTAReturnType>, undefined>, ) {\n\tif ( ctaReturnType instanceof ActionType ) {\n\t\tconst {\n\t\t\ttype,\n\t\t\tnextState,\n\t\t\toptions,\n\t\t} = ctaReturnType;\n\n\t\tif ( !nextState || typeof nextState !== 'object' || Array.isArray( nextState, ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn {\n\t\t\tnext: nextState,\n\t\t\ttype,\n\t\t\tuseCustom: Boolean( options?.useCustom, ),\n\t\t} as typeof type extends 'update' ? {\n\t\t\tnext: Partial<Initial>\n\t\t\ttype: 'update'\n\t\t\tuseCustom: boolean\n\t\t} : {\n\t\t\tnext: Initial\n\t\t\ttype: Exclude<PredefinedActions, 'update'>\n\t\t\tuseCustom: boolean\n\t\t};\n\t}\n\n\tif ( ctaReturnType && typeof ctaReturnType === 'object' ) {\n\t\treturn {\n\t\t\tnext: ctaReturnType as Partial<Initial>,\n\t\t\ttype: 'update' as Extract<PredefinedActions, 'update'>,\n\t\t\tuseCustom: true,\n\t\t};\n\t}\n}\n\nexport type CTAReducerState<Initial extends CTAInitial,> = UseCTAReturnTypeDispatchState<Initial> & {\n\tchangesMap: Map<string | number, unknown>\n};\n\nexport default function ctaReducer<\n\tInitial extends CTAInitial,\n\tActions = undefined,\n>( params: {\n\tctaReducerState: CTAReducerState<Initial>\n\tactions?: Actions\n\tnextCTAProps: Parameters<DispatchCTA<Initial, Actions>>[0]\n}, ): CTAReducerState<Initial> {\n\tconst {\n\t\ttype: ctaType,\n\t\tpayload: nextCTAPropsPayload,\n\t} = params.nextCTAProps;\n\tconst {\n\t\tctaReducerState,\n\t\tactions,\n\t} = params;\n\tconst {\n\t\tchangesMap,\n\t\tcurrent,\n\t\tinitial,\n\t} = ctaReducerState;\n\tconst ctaState: UseCTAReturnTypeDispatchState<Initial> = {\n\t\tchanges: ctaReducerState.changes,\n\t\tcurrent,\n\t\tinitial,\n\t\tprevious: ctaReducerState.previous,\n\t};\n\n\tconst isActionsObject = actions && typeof actions == 'object' && !Array.isArray( actions, );\n\tif ( ctaType in predefinedActionsConst && !isActionsObject ) {\n\t\tif ( ctaType === 'reset' && !nextCTAPropsPayload ) {\n\t\t\tchangesMap.clear();\n\t\t\treturn {\n\t\t\t\t...ctaReducerState,\n\t\t\t\tchanges: null,\n\t\t\t\tcurrent: initial,\n\t\t\t\tprevious: current,\n\t\t\t};\n\t\t}\n\n\t\tconst nextPredefinedState = nextCTAPropsPayload instanceof Function ? nextCTAPropsPayload( ctaState, ) : nextCTAPropsPayload;\n\n\t\treturn typeResult( {\n\t\t\tctaReducerState,\n\t\t\tnext: nextPredefinedState,\n\t\t\ttype: ctaType as PredefinedActions,\n\t\t}, );\n\t}\n\n\tconst cta = isActionsObject && actions?.[ ctaType as keyof typeof actions ];\n\n\tif ( typeof cta !== 'function' ) {\n\t\treturn ctaReducerState;\n\t}\n\n\tif ( ctaType === 'reset' && !nextCTAPropsPayload ) {\n\t\tconst nextResetState = cta(\n\t\t\tctaState,\n\t\t);\n\n\t\tif ( !nextResetState ) {\n\t\t\treturn ctaReducerState;\n\t\t}\n\n\t\tchangesMap.clear();\n\t\treturn {\n\t\t\t...ctaReducerState,\n\t\t\tchanges: null,\n\t\t\tcurrent: nextResetState,\n\t\t\tprevious: current,\n\t\t};\n\t}\n\n\tlet nextPayload = nextCTAPropsPayload;\n\tif ( nextCTAPropsPayload instanceof Function ) {\n\t\tnextPayload = nextCTAPropsPayload(\n\t\t\tctaState,\n\t\t);\n\n\t\tif ( !nextPayload ) {\n\t\t\treturn ctaReducerState;\n\t\t}\n\t}\n\n\tif ( ctaType in predefinedActionsConst ) {\n\t\treturn typeResult( {\n\t\t\tctaReducerState,\n\t\t\tnext: cta(\n\t\t\t\tctaState,\n\t\t\t\tnextPayload,\n\t\t\t),\n\t\t\ttype: ctaType as PredefinedActions,\n\t\t}, );\n\t}\n\n\tconst nextState = cta(\n\t\t{\n\t\t\t...ctaState,\n\t\t\treplaceAction: ReplaceActionType.create<Initial>,\n\t\t\treplaceInitialAction: ReplaceInitialActionType.create<Initial>,\n\t\t\tresetAction: ResetActionType.create<Initial>,\n\t\t\tupdateAction: UpdateActionType.create<Initial>,\n\t\t},\n\t\tnextPayload,\n\t);\n\n\tif ( !nextState ) {\n\t\treturn ctaReducerState;\n\t}\n\n\tconst actionType = getActionType( nextState, );\n\n\tif ( !actionType ) {\n\t\treturn ctaReducerState;\n\t}\n\n\tconst {\n\t\ttype,\n\t\tuseCustom,\n\t} = actionType;\n\n\tlet {\n\t\tnext,\n\t} = actionType;\n\n\tconst customPredefinedCTA = isActionsObject && actions?.[ type as keyof typeof actions ];\n\n\tif ( typeof customPredefinedCTA === 'function' && useCustom ) {\n\t\tnext = customPredefinedCTA( ctaState, next, );\n\t}\n\n\treturn typeResult( {\n\t\tctaReducerState,\n\t\tnext,\n\t\ttype,\n\t}, );\n}\n","import { CTAInitial, } from '../types/CTAInitial';\n\ntype PredefinedActions = 'replace' | 'replaceInitial' | 'reset' | 'update';\n\nexport type ActionTypeConstructParam<Initial extends CTAInitial,> = {\n\ttype: PredefinedActions\n\tnextState: Initial | Partial<Initial>\n\toptions?: { useCustom: boolean }\n};\n\nexport class ActionType<Initial extends CTAInitial,> {\n\treadonly type: ActionTypeConstructParam<Initial>['type'];\n\treadonly nextState: Readonly<ActionTypeConstructParam<Initial>['nextState']>;\n\treadonly options: Readonly<Exclude<ActionTypeConstructParam<Initial>['options'], undefined>>;\n\n\tconstructor( param: ActionTypeConstructParam<Initial>, ) {\n\t\tthis.type = param.type;\n\t\tthis.nextState = param.nextState;\n\t\tthis.options = {\n\t\t\tuseCustom: true,\n\t\t\t...param?.options,\n\t\t};\n\t}\n}\n\nexport class ReplaceActionType<Initial extends CTAInitial,> extends ActionType<Initial> {\n\treadonly type = 'replace';\n\tstatic create<Initial extends CTAInitial,>( nextState: Initial, options?: ActionTypeConstructParam<Initial>['options'], ) {\n\t\treturn new ReplaceActionType( {\n\t\t\tnextState,\n\t\t\toptions,\n\t\t}, );\n\t}\n\n\tconstructor( param: Pick<ActionTypeConstructParam<Initial>, 'options'> & { nextState: Initial }, ) {\n\t\tsuper( {\n\t\t\t...param,\n\t\t\ttype: 'replace',\n\t\t}, );\n\t}\n}\n\nexport class ReplaceInitialActionType<Initial extends CTAInitial,> extends ActionType<Initial> {\n\treadonly type = 'replaceInitial';\n\tstatic create<Initial extends CTAInitial,>( nextState: Initial, options?: ActionTypeConstructParam<Initial>['options'], ) {\n\t\treturn new ReplaceInitialActionType( {\n\t\t\tnextState,\n\t\t\toptions,\n\t\t}, );\n\t}\n\n\tconstructor( param: Pick<ActionTypeConstructParam<Initial>, 'options'> & { nextState: Initial }, ) {\n\t\tsuper( {\n\t\t\t...param,\n\t\t\ttype: 'replaceInitial',\n\t\t}, );\n\t}\n}\n\nexport class ResetActionType<Initial extends CTAInitial,> extends ActionType<Initial> {\n\treadonly type = 'reset';\n\tstatic create<Initial extends CTAInitial,>( nextState: Initial, options?: ActionTypeConstructParam<Initial>['options'], ) {\n\t\treturn new ResetActionType( {\n\t\t\tnextState,\n\t\t\toptions,\n\t\t}, );\n\t}\n\n\tconstructor( param: Pick<ActionTypeConstructParam<Initial>, 'options'> & { nextState: Initial }, ) {\n\t\tsuper( {\n\t\t\t...param,\n\t\t\ttype: 'reset',\n\t\t}, );\n\t}\n}\n\nexport class UpdateActionType<Initial extends CTAInitial,> extends ActionType<Initial> {\n\treadonly type = 'update';\n\tstatic create<Initial extends CTAInitial,>( nextState: Initial, options?: ActionTypeConstructParam<Initial>['options'], ) {\n\t\treturn new UpdateActionType( {\n\t\t\tnextState,\n\t\t\toptions,\n\t\t}, );\n\t}\n\n\tconstructor( param: Pick<ActionTypeConstructParam<Initial>, 'options'> & { nextState: Partial<Initial> }, ) {\n\t\tsuper( {\n\t\t\t...param,\n\t\t\ttype: 'update',\n\t\t}, );\n\t}\n}\n","import { useMemo, } from 'react';\n\nimport type { CTAInitial, } from '../types/CTAInitial';\nimport { UseCTAParameterActionsRecordProp, } from '../types/UseCTAParameterActionsRecordProp';\nimport type { UseCTAReturnType, } from '../types/UseCTAReturnType';\nimport type { DispatchDefaultCTARecord, DispatchCTA, } from '../types/UseCTAReturnTypeDispatch';\nimport type { UsePrivateCTADispatcher, UsePrivateCTAReturnType, } from './usePrivateCTA';\n\nfunction mergeCustomCTAWithDefaultCTA<\n\tInitial extends CTAInitial,\n\tActions,\n>(\n\tdispatch: DispatchCTA<Initial, Actions>,\n\tdefaultCTARecord: DispatchDefaultCTARecord<Initial>,\n\tctaRecord?: Actions,\n) {\n\ttype ActionsRecord = Exclude<Actions, undefined>;\n\ttype CustomActionKeys = Exclude<keyof ActionsRecord, keyof DispatchDefaultCTARecord<Initial>>;\n\tlet hasCustomAction = false;\n\tconst customActions = {} as Record<\n\t\tCustomActionKeys,\n\t\t( payload?: unknown ) => void\n\t>;\n\tfor ( const type in ctaRecord ) {\n\t\tif ( type in defaultCTARecord || typeof ctaRecord[ type ] !== 'function' ) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tcustomActions[ type as unknown as keyof typeof customActions ] = ( payload?: unknown, ) => {\n\t\t\tdispatch( {\n\t\t\t\ttype,\n\t\t\t\tpayload,\n\t\t\t} as unknown as Parameters<DispatchCTA<Initial, Actions>>[0], );\n\t\t};\n\n\t\thasCustomAction = true;\n\t}\n\n\tif ( !hasCustomAction ) {\n\t\treturn defaultCTARecord;\n\t}\n\n\treturn Object.assign(\n\t\tdefaultCTARecord,\n\t\tcustomActions,\n\t);\n}\n\nfunction wrapPrivateDispatcher<\n\tInitial extends CTAInitial,\n\tActions extends UseCTAParameterActionsRecordProp<Initial> | undefined = undefined,\n>(\n\tdispatcher: UsePrivateCTADispatcher<Initial, Actions>,\n\tactions?: Actions,\n) {\n\tconst publicDispatcher: DispatchCTA<Initial, Actions> = ( cta, ) => {\n\t\tdispatcher( cta, );\n\t};\n\n\tconst cta: DispatchDefaultCTARecord<Initial> = {\n\t\treplace( payload, ) {\n\t\t\tpublicDispatcher( {\n\t\t\t\ttype: 'replace',\n\t\t\t\tpayload,\n\t\t\t} as Parameters<DispatchCTA<Initial, Actions>>[0], );\n\t\t},\n\t\treplaceInitial( payload, ) {\n\t\t\tpublicDispatcher( {\n\t\t\t\ttype: 'replaceInitial',\n\t\t\t\tpayload,\n\t\t\t} as Parameters<DispatchCTA<Initial, Actions>>[0], );\n\t\t},\n\t\treset( payload, ) {\n\t\t\tpublicDispatcher( {\n\t\t\t\ttype: 'reset',\n\t\t\t\tpayload,\n\t\t\t} as Parameters<DispatchCTA<Initial, Actions>>[0], );\n\t\t},\n\t\tupdate( payload, value, ) {\n\t\t\tswitch ( typeof payload ) {\n\t\t\t\tcase 'number':\n\t\t\t\tcase 'string':\n\t\t\t\t\tpublicDispatcher( {\n\t\t\t\t\t\ttype: 'update',\n\t\t\t\t\t\tpayload: {\n\t\t\t\t\t\t\t[ payload ]: value,\n\t\t\t\t\t\t},\n\t\t\t\t\t} as Parameters<DispatchCTA<Initial, Actions>>[0], );\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tpublicDispatcher( {\n\t\t\t\t\t\ttype: 'update',\n\t\t\t\t\t\tpayload,\n\t\t\t\t\t} as Parameters<DispatchCTA<Initial, Actions>>[0], );\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t};\n\n\tif ( actions == null || typeof actions !== 'object' ) {\n\t\treturn Object.assign(\n\t\t\tpublicDispatcher,\n\t\t\t{\n\t\t\t\tcta,\n\t\t\t},\n\t\t);\n\t}\n\n\treturn Object.assign(\n\t\tpublicDispatcher,\n\t\t{\n\t\t\tcta: mergeCustomCTAWithDefaultCTA( publicDispatcher, cta, actions, ),\n\t\t},\n\t);\n}\n\nexport default function usePublicCTA<\n\tInitial extends CTAInitial,\n\tActions extends UseCTAParameterActionsRecordProp<Initial> | undefined = undefined,\n>( params: {\n\tactions?: Actions\n\tstateDispatcher: UsePrivateCTAReturnType<Initial, Actions>\n}, ): UseCTAReturnType<Initial, Actions> {\n\tconst {\n\t\tactions,\n\t} = params;\n\tconst [\n\t\tctaState,\n\t\tctaDispatch,\n\t] = params.stateDispatcher;\n\n\tconst augmentedDispatcher = useMemo(\n\t\t() => wrapPrivateDispatcher<Initial, Actions>( ctaDispatch, actions, ),\n\t\t[\n\t\t\tactions,\n\t\t\tctaDispatch,\n\t\t],\n\t);\n\n\treturn useMemo(\n\t\t() => {\n\t\t\tconst state: UseCTAReturnType<Initial, Actions>[1]['state'] = {\n\t\t\t\tchanges: ctaState.changes,\n\t\t\t\tcurrent: ctaState.current,\n\t\t\t\tinitial: ctaState.initial,\n\t\t\t\tprevious: ctaState.previous,\n\t\t\t};\n\t\t\tconst dispatch = Object.assign(\n\t\t\t\taugmentedDispatcher,\n\t\t\t\t{\n\t\t\t\t\tstate,\n\t\t\t\t},\n\t\t\t);\n\t\t\treturn [\n\t\t\t\tctaState.current,\n\t\t\t\tdispatch as unknown as UseCTAReturnType<Initial, Actions>[1],\n\t\t\t];\n\t\t},\n\t\t[\n\t\t\tctaState,\n\t\t\taugmentedDispatcher,\n\t\t],\n\t);\n}\n"],"names":[],"version":3,"file":"index.js.map"}